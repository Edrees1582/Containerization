name: Docker Image Publish

on:
  push:
    branches: [ 'main' ]

jobs:
  build-and-push:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
    
    - name: Build and push Docker images
      run: |
        docker login -u ${{ secrets.DOCKERHUB_USERNAME }} -p ${{ secrets.DOCKERHUB_TOKEN }}
        docker-compose build
        services=(containerization-mysqldb containerization-mongodb containerization-authentication containerization-enter-data containerization-analytics containerization-show-results)
        for service in "${services[@]}"; do
          docker tag $service edrees1582/$service:latest
          docker push edrees1582/$service
        done


# on:
#   push:
#     branches: [ 'main' ]
# jobs:
#   deploy:
#     name: build && push image to docker hub
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@v3
#         with:
#           ref: 'main'
    
#       - name: setup docker buildx
#         uses: docker/setup-buildx-action@v2
    
#       - name: docker login
#         uses: docker/login-action@v2
#         with:
#           username: ${{ secrets.DOCKERHUB_USERNAME }}
#           password: ${{ secrets.DOCKERHUB_TOKEN }}
      
#       - name: build and push api
#         id: build-push-api
#         uses: docker/build-push-action@v3
#         with:
#           context: .
#           file: Dockerfile
#           push: true
#           tags: edrees1582/containerization:latest
