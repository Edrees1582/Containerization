name: Docker Image Publish

on:
  push:
    branches: [ 'main' ]

jobs:
  build-and-push:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
    
    - name: Build and push Docker images
      run: |
        docker-compose build
        docker tag containerization-mysqldb edrees1582/containerization-mysqldb:latest
        docker tag containerization-mongodb edrees1582/containerization-mongodb:latest
        docker tag containerization-authentication edrees1582/containerization-authentication:latest
        docker tag containerization-enter-data edrees1582/containerization-enter-data:latest
        docker tag containerization-analytics edrees1582/containerization-analytics:latest
        docker tag containerization-show-results edrees1582/containerization-show-results:latest
        docker login -u ${{ secrets.DOCKERHUB_USERNAME }} -p ${{ secrets.DOCKERHUB_TOKEN }}
        docker push edrees1582/containerization-mysqldb:latest
        docker push edrees1582/containerization-mongodb:latest
        docker push edrees1582/containerization-authentication:latest
        docker push edrees1582/containerization-enter-data:latest
        docker push edrees1582/containerization-analytics:latest
        docker push edrees1582/containerization-show-results:latest


# on:
#   push:
#     branches: [ 'main' ]
# jobs:
#   deploy:
#     name: build && push image to docker hub
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@v3
#         with:
#           ref: 'main'
    
#       - name: setup docker buildx
#         uses: docker/setup-buildx-action@v2
    
#       - name: docker login
#         uses: docker/login-action@v2
#         with:
#           username: ${{ secrets.DOCKERHUB_USERNAME }}
#           password: ${{ secrets.DOCKERHUB_TOKEN }}
      
#       - name: build and push api
#         id: build-push-api
#         uses: docker/build-push-action@v3
#         with:
#           context: .
#           file: Dockerfile
#           push: true
#           tags: edrees1582/containerization:latest
